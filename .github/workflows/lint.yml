name: Lint Code with Pylint

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  lint:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'  # specify the Python version you need

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pylint

    - name: Run Pylint
      id: pylint
      run: |
        # Run pylint and capture the output
        pylint_output=$(pylint **/*.py --exit-zero)

        # Check for errors or fatal messages
        error_count=$(echo "$pylint_output" | grep -E "(error|fatal)" | wc -l)
        if [ "$error_count" -ne 0 ]; then
          echo "Pylint found errors or fatal issues. Exiting."
          exit 1
        fi

        # Extract the pylint score from the output
        pylint_score=$(echo "$pylint_output" | grep "Your code has been rated at" | awk '{print $7}' | cut -d/ -f1)

        # Ensure the score is 7.0 or higher
        if (( $(echo "$pylint_score < 7.0" | bc -l) )); then
          echo "Pylint score is below 7/10. Exiting."
          exit 1
        fi

        echo "Pylint score: $pylint_score"

    - name: Success Message
      if: success()
      run: echo "Linting passed successfully with a score above 7/10!"

